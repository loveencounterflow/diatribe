{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n\n'use strict'\n\n#===========================================================================================================\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'diatribe'\n{ rpr\n  inspect\n  echo\n  reverse\n  bold\n  log     }               = GUY.trm\n#...........................................................................................................\nCLK                       = require '@clack/prompts'\nPATH                      = require 'node:path'\nmark                      = ( ref ) -> urge reverse bold \" #{ref} \"\nE                         = require './errors'\n\n\n#===========================================================================================================\nclass Interactive_dialog\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( steps ) ->\n    @cfg        = Object.freeze { unique_refs: true, } ### TAINT make configurable ###\n    @_pc        = -1\n    @results    = {}\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _record: ( cfg, value ) ->\n    @_pc++\n    ref = cfg?.ref ? \"$q#{@_pc + 1}\"\n    #.......................................................................................................\n    if @cfg.unique_refs and Reflect.has @results, ref\n      message = \"duplicate ref: #{ref}\"\n      throw new E.Dulicate_ref_error message\n    #.......................................................................................................\n    @results[ ref ]     = value\n    return value\n\n  #---------------------------------------------------------------------------------------------------------\n  ctrlc: ( value ) ->\n    # debug 'Î©___3', rpr value\n    if CLK.isCancel value\n      CLK.cancel \"Operation cancelled.\"\n      @process_exit 0\n    return value\n\n  #---------------------------------------------------------------------------------------------------------\n  intro:        ( cfg ) ->                @ctrlc await CLK.intro       cfg\n  outro:        ( cfg ) ->                @ctrlc await CLK.outro       cfg\n  confirm:      ( cfg ) -> @_record cfg,  @ctrlc await CLK.confirm     cfg\n  text:         ( cfg ) -> @_record cfg,  @ctrlc await CLK.text        cfg\n  select:       ( cfg ) -> @_record cfg,  @ctrlc await CLK.select      cfg\n  multiselect:  ( cfg ) -> @_record cfg,  @ctrlc await CLK.multiselect cfg\n  get_spinner:  ( cfg ) -> CLK.spinner()\n  finish:               -> null\n\n  #---------------------------------------------------------------------------------------------------------\n  process_exit: ( code = 0 ) -> process.exit code\n\n\n#===========================================================================================================\nclass Programmatic_dialog\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( steps ) ->\n    @cfg        = Object.freeze { unique_refs: true, } ### TAINT make configurable ###\n    @_exp_steps = steps\n    @_exp_keys  = Object.keys @_exp_steps\n    @_pc        = -1\n    @_act_steps = {}\n    @results    = {}\n    #.......................................................................................................\n    GUY.props.def @, '_failures',\n      enumerable:   false\n      configurable: false\n      get:          -> ( d for d in @_act_steps when d instanceof E.Dialog_failure )\n    #.......................................................................................................\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _next: ( ref ) ->\n    @_pc++\n    if ( not ( key = @_exp_keys[ @_pc ] ? null )? ) or ( not ( R = @_exp_steps[ key ] ? null )? )\n      message = \"emergency halt, running too long: act #{@_count_act_steps()} exp #{@_exp_keys.length}\"\n      @_fail ref, new E.Overrun_failure message\n      throw new E.Overrun_error message\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  _fail: ( ref, failure ) ->\n    @_act_steps[ ref ] = failure\n    @_failures.push failure\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _step: ( act_key, cfg ) ->\n    ref = cfg?.ref ? \"$q#{@_pc + 2}\"\n    #.......................................................................................................\n    if @cfg.unique_refs and Reflect.has @results, ref\n      message = \"duplicate ref: #{ref}\"\n      @_fail ref, new E.Duplicate_ref_failure message\n      throw new E.Dulicate_ref_error message\n    #.......................................................................................................\n    [ exp_key, value, ] = @_next ref\n    @results[ ref ]     = value\n    #.......................................................................................................\n    if act_key is exp_key\n      @_act_steps[ ref ] = act_key\n    else\n      @_act_steps[ ref ] = new E.Misstep_failure \"step##{@_pc}: act #{rpr act_key}, exp #{rpr exp_key}\"\n    return await GUY.async.defer -> value\n\n  #---------------------------------------------------------------------------------------------------------\n  _count_act_steps: -> @_pc + 1\n  _is_finished:     -> @_count_act_steps() is @_exp_keys.length\n  # _is_underrun:     -> @_count_act_steps() <  @_exp_keys.length\n  _is_overrun:      -> @_count_act_steps() >  @_exp_keys.length\n\n  #---------------------------------------------------------------------------------------------------------\n  finish: ( P... ) ->\n    #### `dlg.finish()` should be called after the simulated dialog has ben run to issue an  ####\n    return true if @_is_finished() or @_is_overrun()\n    @_fail '$finish', new E.Underrun_failure \"finished too early: act #{@_count_act_steps()} exp #{@_exp_keys.length}\"\n    return false\n\n  #---------------------------------------------------------------------------------------------------------\n  intro:        ( cfg ) -> null\n  outro:        ( cfg ) -> null\n  confirm:      ( cfg ) -> await @_step 'confirm',      cfg\n  text:         ( cfg ) -> await @_step 'text',         cfg\n  select:       ( cfg ) -> await @_step 'select',       cfg\n  multiselect:  ( cfg ) -> await @_step 'multiselect',  cfg\n  get_spinner:          -> { start: ( -> ), stop: ( -> ), }\n\n  #---------------------------------------------------------------------------------------------------------\n  process_exit: ( code ) ->\n    # not really exiting the process\n    return code\n\n\n\n#===========================================================================================================\nmodule.exports = { Programmatic_dialog, Interactive_dialog, errors: E, }\n"
  ]
}